<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game View (Legacy Skin)</title>
    <link rel="stylesheet" href="/legacy/phalla.css" />
  </head>
  <body>
    <div id="legacyHeader"></div>
    <div align="center">
      <div class="page" style="width:98%; text-align:left">
        <div style="padding:0px 10px 0px 10px">
          <div style="margin:10px 0;">
            <a href="/legacy/index.html">&laquo; back to games</a>
          </div>

          <table class="tborder" cellpadding="4" cellspacing="1" border="0" width="100%" align="center">
            <thead>
              <tr align="center">
                <td class="thead" width="100%" align="left" id="gameTitle">Loading...</td>
                <td class="thead" width="175">Last Post</td>
                <td class="thead">Players</td>
                <td class="thead">Day</td>
                <td class="thead">Open</td>
              </tr>
            </thead>
            <tbody id="gameMeta"></tbody>
          </table>

          <div class="smallfont" style="margin:6px 2px;">
            <a id="playerListLink" href="#">view player list</a>
          </div>

          <div id="postsContainer" style="margin-top:10px;"></div>

          <div
            id="voteTalliesSection"
            class="smallfont"
            style="display:none; margin-top:12px;"
          >
            <div id="voteTalliesStatus" style="margin-bottom:4px;"></div>
            <table
              class="tborder"
              cellpadding="4"
              cellspacing="1"
              border="0"
              width="100%"
              align="center"
            >
              <thead>
                <tr align="center">
                  <td class="thead" width="45%" align="left">Player</td>
                  <td class="thead" width="120">Alive</td>
                  <td class="thead" width="80">Votes</td>
                  <td class="thead" align="left">Voters</td>
                </tr>
              </thead>
              <tbody id="voteTalliesBody">
                <tr>
                  <td class="alt1" colspan="4" align="center">Loading votes…</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Quick reply / actions -->
          <div style="margin-top:12px;">
            <div id="ownerControls" class="smallfont" style="display:none; margin-bottom:8px;">
              <b>Owner Controls:</b>
              <button
                id="toggleOpen"
                class="button"
                title="Flip whether the game is listed as open for new signups or closed to recruiting. This updates lobby status only—it does not automatically block players from joining."
              >
                Toggle Open
              </button>
              <button
                id="toggleActive"
                class="button"
                title="Mark the game as running or finished so listings and headers show the correct state. This flag is informational and does not stop players from posting or taking actions."
              >
                Toggle Active
              </button>
              <button
                id="nextDay"
                class="button"
                title="Increase the day counter when you advance the story. The new value drives vote tallies, action logs, and moderator tools that track progress."
              >
                Next Day
              </button>
              <button
                id="daySummary"
                class="button"
                title="Open the moderator control panel to review recorded actions and use owner tools like resets, game-over posts, or clearing the thread."
              >
                Day Summary
              </button>
            </div>
            <div class="smallfont" style="margin-bottom:8px;">
              <button
                id="joinButton"
                class="button"
                title="Add yourself to the roster so you can post, record actions, and receive any private access the host assigns."
              >
                Join Game
              </button>
              <button
                id="leaveButton"
                class="button"
                style="display:none;"
                title="Withdraw from the roster if you can no longer participate. Leaving immediately frees the slot and removes your private tools."
              >
                Leave Game
              </button>
            </div>
            <div id="playerTools" class="smallfont" style="display:none; margin-bottom:12px;">
              <div><strong>Private Game Tools</strong></div>
              <form id="privateActionForm" class="stacked-form">
                <label>
                  Action name
                  <select id="privateActionName" class="bginput"></select>
                  <input
                    id="privateActionNameCustom"
                    class="bginput"
                    style="display:none; margin-top:6px;"
                    placeholder="Enter action name"
                  />
                </label>
                <label>
                  Target name
                  <select id="privateActionTarget" class="bginput"></select>
                  <input
                    id="privateActionTargetCustom"
                    class="bginput"
                    style="display:none; margin-top:6px;"
                    placeholder="Enter target name"
                  />
                </label>
                <label>
                  Day
                  <input id="privateActionDay" type="number" class="bginput" min="0" />
                </label>
                <div>
                  <button
                    class="button"
                    type="submit"
                    title="Record this private action so it appears in your log and the host's day summary, keeping night powers documented."
                  >
                    Record private action
                  </button>
                </div>
              </form>
              <form id="voteRecordForm" class="stacked-form">
                <label>
                  Vote target
                  <select id="voteTarget" class="bginput"></select>
                </label>
                <label>
                  Notes
                  <input id="voteNotes" class="bginput" />
                </label>
                <div>
                  <button
                    class="button"
                    type="submit"
                    title="Save your current vote target, update the shared tally, and keep optional notes in your private history (visible to you and the host)."
                  >
                    Record vote
                  </button>
                </div>
              </form>
              <form id="claimRecordForm" class="stacked-form">
                <label>
                  Claim role
                  <select id="claimRoleSelect" class="bginput"></select>
                  <input
                    id="claimRoleCustom"
                    class="bginput"
                    style="display:none; margin-top:6px;"
                    placeholder="Enter role name"
                  />
                </label>
                <div>
                  <button
                    class="button"
                    type="submit"
                    title="Log the role you're claiming so it appears in your private history and the moderator's records without broadcasting a public announcement."
                  >
                    Record claim
                  </button>
                </div>
              </form>
              <form id="notebookRecordForm" class="stacked-form">
                <label>
                  Notebook target
                  <select id="notebookTarget" class="bginput"></select>
                </label>
                <label>
                  Notes
                  <input id="notebookNotes" class="bginput" />
                </label>
                <div>
                  <button
                    class="button"
                    type="submit"
                    title="Store a private notebook entry about the selected player so you can revisit your deductions or reminders later without sharing them publicly."
                  >
                    Save notebook entry
                  </button>
                </div>
              </form>
              <div id="playerToolsStatus" style="display:none; margin-top:6px; color:#F9A906;"></div>
              <div
                id="actionHistorySection"
                style="display:none; margin-top:12px;"
              >
                <div><strong>Action History</strong></div>
                <div id="actionHistoryContent" style="margin-top:6px;"></div>
              </div>
            </div>
            <div id="moderatorPanel" class="smallfont" style="display:none; margin-bottom:12px;">
              <div><strong>Moderator Player Management</strong></div>
              <div id="moderatorStatus" style="display:none; margin:6px 0; color:#F9A906;"></div>
              <div
                id="replacePlayerControls"
                style="display:none; margin:6px 0; padding:6px; background-color:#0f172a; border:1px solid #27364f;"
              >
                <div style="margin-bottom:6px;">
                  Replacing <span id="replacePlayerName" style="font-weight:bold;">(unknown)</span>
                </div>
                <label>
                  Replacement player
                  <select id="replacePlayerSelect" class="bginput"></select>
                  <input
                    id="replacePlayerCustom"
                    class="bginput"
                    style="display:none; margin-top:6px;"
                    placeholder="Enter username, email, or UID"
                  />
                </label>
                <div style="margin-top:6px;">
                  <button
                    class="button"
                    id="confirmReplaceButton"
                    type="button"
                    title="Finalize swapping in the selected replacement player. Confirming immediately updates rosters, permissions, and role assignments."
                  >
                    Confirm replace
                  </button>
                  <button
                    class="button"
                    id="cancelReplaceButton"
                    type="button"
                    style="margin-left:4px;"
                    title="Back out of the replacement flow without making any changes, letting you revisit the decision or choose someone else."
                  >
                    Cancel
                  </button>
                </div>
              </div>
              <table class="tborder" cellpadding="4" cellspacing="1" border="0" width="100%" style="margin-top:6px;">
                <thead>
                  <tr align="center">
                    <td class="thead" width="240">Player</td>
                    <td class="thead" width="200">Role</td>
                    <td class="thead" width="120">Status</td>
                    <td class="thead" width="120">Posts left</td>
                    <td class="thead" width="200">Actions</td>
                  </tr>
                </thead>
                <tbody id="moderatorRows">
                  <tr>
                    <td class="alt1" colspan="5" align="center">Loading players…</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <a id="reply"></a>
            <form id="replyForm" style="display:none;" onsubmit="return false;">
              <table cellpadding="4" cellspacing="0" border="0" width="100%" class="tborder">
                <tr>
                  <td class="alt2">
                    <div class="smallfont">Title</div>
                    <input id="replyTitle" class="bginput" style="width:98%" />
                    <div class="smallfont" style="margin-top:6px;">Message (UBB)</div>
                    <div class="ubb-toolbar">
                      <button
                        type="button"
                        class="ubb-button"
                        data-ubb-tag="b"
                        title="Wrap the highlighted text in [b] tags so it appears in bold when your post is published, helping important points stand out."
                      >
                        B
                      </button>
                      <button
                        type="button"
                        class="ubb-button"
                        data-ubb-tag="i"
                        title="Surround the selected text with [i] tags so it renders in italics, ideal for emphasis or quoting other players."
                      >
                        I
                      </button>
                      <button
                        type="button"
                        class="ubb-button"
                        data-ubb-tag="u"
                        title="Place [u] tags around the chosen text to underline it in the final post, drawing attention to critical statements or votes."
                      >
                        U
                      </button>
                    </div>
                    <textarea id="replyBody" class="bginput" rows="6" style="width:98%"></textarea>
                    <div
                      id="publicActionsBlock"
                      class="smallfont"
                      style="margin-top:12px; display:none;"
                    >
                      <div><strong>Actions</strong></div>
                      <div class="public-actions-list">
                        <div id="publicActionVoteRow" class="public-action-row">
                          <label>
                            <input type="checkbox" id="publicActionVote" />
                            Vote
                          </label>
                          <select
                            id="publicActionVoteTarget"
                            class="bginput"
                            style="margin-left:6px;"
                          ></select>
                        </div>
                        <div id="publicActionUnvoteRow" class="public-action-row">
                          <label>
                            <input type="checkbox" id="publicActionUnvote" />
                            Unvote
                          </label>
                        </div>
                        <div id="publicActionClaimRow" class="public-action-row">
                          <label>
                            <input type="checkbox" id="publicActionClaim" />
                            Claim
                          </label>
                          <div style="margin-top:4px;">
                            <select id="publicClaimRoleSelect" class="bginput"></select>
                            <input
                              id="publicClaimRoleCustom"
                              class="bginput"
                              style="display:none; margin-top:6px; width:250px;"
                              placeholder="Enter role name"
                            />
                          </div>
                        </div>
                        <div id="publicActionNotebookRow" class="public-action-row">
                          <label>
                            <input type="checkbox" id="publicActionNotebook" />
                            Notebook
                          </label>
                          <div style="margin-top:4px;">
                            <select id="publicNotebookTarget" class="bginput"></select>
                            <input
                              id="publicNotebookNotes"
                              class="bginput"
                              style="margin-top:6px; width:250px;"
                              placeholder="Notes (optional)"
                            />
                          </div>
                        </div>
                      </div>
                      <div
                        id="publicActionsStatus"
                        class="smallfont"
                        style="display:none; margin-top:6px; color:#F9A906;"
                      ></div>
                    </div>
                    <div style="margin-top:8px;">
                      <button
                        id="postReply"
                        class="button"
                        title="Publish your reply to the game thread along with any selected public actions, making your message and moves visible to everyone."
                      >
                        Post Reply
                      </button>
                    </div>
                  </td>
                </tr>
              </table>
            </form>
            <div id="privateChannelsSection" style="margin-top:20px; display:none;">
              <table class="tborder" cellpadding="4" cellspacing="1" border="0" width="100%" align="center" style="margin-bottom:6px;">
                <tr>
                  <td class="thead">Role Discussions</td>
                </tr>
              </table>
              <div id="privateChannelsStatus" class="smallfont" style="display:none; margin:6px 2px; color:#F9A906;"></div>
              <div id="privateChannelsContainer"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/legacy/game.js"></script>
  </body>
  </html>
