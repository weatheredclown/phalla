<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NAT Handshake Lab</title>
    <link rel="stylesheet" href="../common.css" />
    <link rel="stylesheet" href="../widgets.css" />
    <link rel="stylesheet" href="./nat-handshake-lab.css" />
  </head>
  <body>
    <header>
      <div class="header-bar">
        <div class="header-text">
          <p>Layer 05 · Edge Negotiator</p>
          <h1>NAT Handshake Lab</h1>
        </div>
        <button
          type="button"
          class="fullscreen-toggle"
          data-role="fullscreen-toggle"
          data-fullscreen="false"
          aria-pressed="false"
        >
          <span class="fullscreen-toggle__label fullscreen-toggle__label--enter" data-state="enter">Enter full screen</span>
          <span class="fullscreen-toggle__label fullscreen-toggle__label--exit" data-state="exit">Exit full screen</span>
        </button>
      </div>
      <p>
        A stack of remote crews are calling in from hotel Wi-Fi. Shape your translation table and keepalive plan so every
        handshake survives the journey through the beige NAT gateway.
      </p>
    </header>
    <main>
      <section class="control-panel" aria-labelledby="nat-console">
        <h2 id="nat-console">Translation console</h2>
        <p class="intro-copy">
          Pair each request with the right mapping style and keepalive cadence. The gateway exposes limited ports — drop the
          wrong policy and the session collapses.
        </p>
        <section class="visual-panel" aria-labelledby="visualizer">
          <h3 id="visualizer">Realtime handshake monitor</h3>
          <p class="visual-intro">
            Watch simulated traffic pulses as you stage policies. Each lane forecasts how the translation will hold before you
            commit it to the gateway.
          </p>
          <div class="visual-grid">
            <article class="visual-card" data-session="stun">
              <header>
                <h4>Satellite Uplink Crew</h4>
                <span class="visual-status" aria-live="polite">Idle</span>
              </header>
              <div class="handshake-diagram" aria-hidden="true">
                <div class="node node--client">Crew</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--nat">NAT</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--remote">Relay</div>
              </div>
              <p class="visual-message">Awaiting translation policy.</p>
            </article>
            <article class="visual-card" data-session="ftp">
              <header>
                <h4>Graphics Vendor FTP</h4>
                <span class="visual-status" aria-live="polite">Idle</span>
              </header>
              <div class="handshake-diagram" aria-hidden="true">
                <div class="node node--client">Client</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--nat">NAT</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--remote">Server</div>
              </div>
              <p class="visual-message">Awaiting translation policy.</p>
            </article>
            <article class="visual-card" data-session="tunnel">
              <header>
                <h4>Investigations VPN Tunnel</h4>
                <span class="visual-status" aria-live="polite">Idle</span>
              </header>
              <div class="handshake-diagram" aria-hidden="true">
                <div class="node node--client">Agents</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--nat">NAT</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--remote">HQ</div>
              </div>
              <p class="visual-message">Awaiting translation policy.</p>
            </article>
          </div>
        </section>
        <div class="hud" role="status" aria-live="polite">
          <div class="hud-card">
            <h3>Score</h3>
            <output id="nat-score" aria-live="off">0</output>
          </div>
          <div class="hud-card">
            <h3>Gateway stability</h3>
            <div class="stability-bar" aria-hidden="true">
              <div id="stability-fill"></div>
            </div>
            <output id="stability-display" aria-live="off">100%</output>
          </div>
          <div class="hud-card">
            <h3>Translations locked</h3>
            <output id="session-progress" aria-live="off">0 / 3</output>
          </div>
        </div>
        <form id="nat-form" class="form-grid">
          <fieldset>
            <legend>Connection queue</legend>
            <div class="session-grid">
              <article class="session-card" data-session="stun">
                <h3>Satellite Uplink Crew</h3>
                <p class="summary">
                  Needs low-latency voice via UDP 3478. Remote base polls with STUN every 20 seconds.
                </p>
                <p class="control-label" id="mapping-stun-label">Mapping style</p>
                <div
                  class="neon-select"
                  data-widget="neon-select"
                  aria-labelledby="mapping-stun-label"
                >
                  <input type="hidden" name="mapping-stun" value="" />
                  <div class="neon-select__rail">
                    <button class="neon-select__option" data-value="" type="button">
                      <span class="neon-select__option-title">Choose a mapping…</span>
                    </button>
                    <button class="neon-select__option" data-value="static" type="button">
                      <span class="neon-select__option-title">Static pinhole</span>
                    </button>
                    <button class="neon-select__option" data-value="restricted" type="button">
                      <span class="neon-select__option-title">Restricted cone</span>
                    </button>
                    <button class="neon-select__option" data-value="preserving" type="button">
                      <span class="neon-select__option-title">Port-preserving</span>
                    </button>
                    <button class="neon-select__option" data-value="symmetric" type="button">
                      <span class="neon-select__option-title">Symmetric</span>
                    </button>
                  </div>
                </div>
                <p class="control-label" id="keepalive-stun-label">Keepalive tactic</p>
                <div
                  class="neon-select"
                  data-widget="neon-select"
                  aria-labelledby="keepalive-stun-label"
                >
                  <input type="hidden" name="keepalive-stun" value="" />
                  <div class="neon-select__rail">
                    <button class="neon-select__option" data-value="" type="button">
                      <span class="neon-select__option-title">Choose a keepalive…</span>
                    </button>
                    <button class="neon-select__option" data-value="stun" type="button">
                      <span class="neon-select__option-title">STUN binding refresh</span>
                    </button>
                    <button class="neon-select__option" data-value="udp" type="button">
                      <span class="neon-select__option-title">Manual UDP ping</span>
                    </button>
                    <button class="neon-select__option" data-value="alg" type="button">
                      <span class="neon-select__option-title">Application-layer gateway assist</span>
                    </button>
                  </div>
                </div>
              </article>
              <article class="session-card" data-session="ftp">
                <h3>Graphics Vendor FTP</h3>
                <p class="summary">
                  Passive-mode file drop. Control on TCP 21, ephemeral data ports follow client suggestion.
                </p>
                <p class="control-label" id="mapping-ftp-label">Mapping style</p>
                <div
                  class="neon-select"
                  data-widget="neon-select"
                  aria-labelledby="mapping-ftp-label"
                >
                  <input type="hidden" name="mapping-ftp" value="" />
                  <div class="neon-select__rail">
                    <button class="neon-select__option" data-value="" type="button">
                      <span class="neon-select__option-title">Choose a mapping…</span>
                    </button>
                    <button class="neon-select__option" data-value="static" type="button">
                      <span class="neon-select__option-title">Static pinhole</span>
                    </button>
                    <button class="neon-select__option" data-value="restricted" type="button">
                      <span class="neon-select__option-title">Restricted cone</span>
                    </button>
                    <button class="neon-select__option" data-value="preserving" type="button">
                      <span class="neon-select__option-title">Port-preserving</span>
                    </button>
                    <button class="neon-select__option" data-value="symmetric" type="button">
                      <span class="neon-select__option-title">Symmetric</span>
                    </button>
                  </div>
                </div>
                <p class="control-label" id="keepalive-ftp-label">Keepalive tactic</p>
                <div
                  class="neon-select"
                  data-widget="neon-select"
                  aria-labelledby="keepalive-ftp-label"
                >
                  <input type="hidden" name="keepalive-ftp" value="" />
                  <div class="neon-select__rail">
                    <button class="neon-select__option" data-value="" type="button">
                      <span class="neon-select__option-title">Choose a keepalive…</span>
                    </button>
                    <button class="neon-select__option" data-value="stun" type="button">
                      <span class="neon-select__option-title">STUN binding refresh</span>
                    </button>
                    <button class="neon-select__option" data-value="udp" type="button">
                      <span class="neon-select__option-title">Manual UDP ping</span>
                    </button>
                    <button class="neon-select__option" data-value="alg" type="button">
                      <span class="neon-select__option-title">Application-layer gateway assist</span>
                    </button>
                  </div>
                </div>
              </article>
              <article class="session-card" data-session="tunnel">
                <h3>Investigations VPN Tunnel</h3>
                <p class="summary">ESP-over-UDP fallback, expects periodic DPD keepalives and consistent outer ports.</p>
                <p class="control-label" id="mapping-tunnel-label">Mapping style</p>
                <div
                  class="neon-select"
                  data-widget="neon-select"
                  aria-labelledby="mapping-tunnel-label"
                >
                  <input type="hidden" name="mapping-tunnel" value="" />
                  <div class="neon-select__rail">
                    <button class="neon-select__option" data-value="" type="button">
                      <span class="neon-select__option-title">Choose a mapping…</span>
                    </button>
                    <button class="neon-select__option" data-value="static" type="button">
                      <span class="neon-select__option-title">Static pinhole</span>
                    </button>
                    <button class="neon-select__option" data-value="restricted" type="button">
                      <span class="neon-select__option-title">Restricted cone</span>
                    </button>
                    <button class="neon-select__option" data-value="preserving" type="button">
                      <span class="neon-select__option-title">Port-preserving</span>
                    </button>
                    <button class="neon-select__option" data-value="symmetric" type="button">
                      <span class="neon-select__option-title">Symmetric</span>
                    </button>
                  </div>
                </div>
                <p class="control-label" id="keepalive-tunnel-label">Keepalive tactic</p>
                <div
                  class="neon-select"
                  data-widget="neon-select"
                  aria-labelledby="keepalive-tunnel-label"
                >
                  <input type="hidden" name="keepalive-tunnel" value="" />
                  <div class="neon-select__rail">
                    <button class="neon-select__option" data-value="" type="button">
                      <span class="neon-select__option-title">Choose a keepalive…</span>
                    </button>
                    <button class="neon-select__option" data-value="stun" type="button">
                      <span class="neon-select__option-title">STUN binding refresh</span>
                    </button>
                    <button class="neon-select__option" data-value="udp" type="button">
                      <span class="neon-select__option-title">Manual UDP ping</span>
                    </button>
                    <button class="neon-select__option" data-value="alg" type="button">
                      <span class="neon-select__option-title">Application-layer gateway assist</span>
                    </button>
                  </div>
                </div>
              </article>
            </div>
            <button type="submit" class="execute-button">Negotiate mappings</button>
          </fieldset>
        </form>
        <div id="nat-status" class="status-board" aria-live="polite">Gateway idle. Awaiting policy.</div>
      </section>
      <section class="log-panel" aria-labelledby="negotiation-log">
        <h2 id="negotiation-log">Negotiation log</h2>
        <ul id="timeline" class="log-list" aria-live="polite"></ul>
      </section>
    </main>
    <footer>Keep the translators lean and the crew online.</footer>
    <script src="../widgets.js" type="module"></script>
    <script type="module" src="./nat-handshake-lab.js"></script>
  </body>
</html>
