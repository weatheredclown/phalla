<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NAT Handshake Lab</title>
    <link rel="stylesheet" href="../common.css" />
    <link rel="stylesheet" href="./nat-handshake-lab.css" />
  </head>
  <body>
    <header>
      <div class="header-bar">
        <div class="header-text">
          <p>Layer 05 · Edge Negotiator</p>
          <h1>NAT Handshake Lab</h1>
        </div>
        <button
          type="button"
          class="fullscreen-toggle"
          data-role="fullscreen-toggle"
          data-fullscreen="false"
          aria-pressed="false"
        >
          <span class="fullscreen-toggle__label fullscreen-toggle__label--enter" data-state="enter">Enter full screen</span>
          <span class="fullscreen-toggle__label fullscreen-toggle__label--exit" data-state="exit">Exit full screen</span>
        </button>
      </div>
      <p>
        A stack of remote crews are calling in from hotel Wi-Fi. Shape your translation table and keepalive plan so every
        handshake survives the journey through the beige NAT gateway.
      </p>
    </header>
    <main>
      <section class="control-panel" aria-labelledby="nat-console">
        <h2 id="nat-console">Translation console</h2>
        <p class="intro-copy">
          Pair each request with the right mapping style and keepalive cadence. The gateway exposes limited ports — drop the
          wrong policy and the session collapses.
        </p>
        <section class="visual-panel" aria-labelledby="visualizer">
          <h3 id="visualizer">Realtime handshake monitor</h3>
          <p class="visual-intro">
            Watch simulated traffic pulses as you stage policies. Each lane forecasts how the translation will hold before you
            commit it to the gateway.
          </p>
          <div class="visual-grid">
            <article class="visual-card" data-session="stun">
              <header>
                <h4>Satellite Uplink Crew</h4>
                <span class="visual-status" aria-live="polite">Idle</span>
              </header>
              <div class="handshake-diagram" aria-hidden="true">
                <div class="node node--client">Crew</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--nat">NAT</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--remote">Relay</div>
              </div>
              <p class="visual-message">Awaiting translation policy.</p>
            </article>
            <article class="visual-card" data-session="ftp">
              <header>
                <h4>Graphics Vendor FTP</h4>
                <span class="visual-status" aria-live="polite">Idle</span>
              </header>
              <div class="handshake-diagram" aria-hidden="true">
                <div class="node node--client">Client</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--nat">NAT</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--remote">Server</div>
              </div>
              <p class="visual-message">Awaiting translation policy.</p>
            </article>
            <article class="visual-card" data-session="tunnel">
              <header>
                <h4>Investigations VPN Tunnel</h4>
                <span class="visual-status" aria-live="polite">Idle</span>
              </header>
              <div class="handshake-diagram" aria-hidden="true">
                <div class="node node--client">Agents</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--nat">NAT</div>
                <div class="link">
                  <span class="pulse"></span>
                </div>
                <div class="node node--remote">HQ</div>
              </div>
              <p class="visual-message">Awaiting translation policy.</p>
            </article>
          </div>
        </section>
        <div class="hud" role="status" aria-live="polite">
          <div class="hud-card">
            <h3>Score</h3>
            <output id="nat-score" aria-live="off">0</output>
          </div>
          <div class="hud-card">
            <h3>Gateway stability</h3>
            <div class="stability-bar" aria-hidden="true">
              <div id="stability-fill"></div>
            </div>
            <output id="stability-display" aria-live="off">100%</output>
          </div>
          <div class="hud-card">
            <h3>Translations locked</h3>
            <output id="session-progress" aria-live="off">0 / 3</output>
          </div>
        </div>
        <form id="nat-form" class="form-grid">
          <fieldset>
            <legend>Connection queue</legend>
            <div class="session-grid">
              <article class="session-card" data-session="stun">
                <h3>Satellite Uplink Crew</h3>
                <p class="summary">
                  Needs low-latency voice via UDP 3478. Remote base polls with STUN every 20 seconds.
                </p>
                <label for="mapping-stun">Mapping style</label>
                <select id="mapping-stun" name="mapping-stun">
                  <option value="">Choose a mapping…</option>
                  <option value="static">Static pinhole</option>
                  <option value="restricted">Restricted cone</option>
                  <option value="preserving">Port-preserving</option>
                  <option value="symmetric">Symmetric</option>
                </select>
                <label for="keepalive-stun">Keepalive tactic</label>
                <select id="keepalive-stun" name="keepalive-stun">
                  <option value="">Choose a keepalive…</option>
                  <option value="stun">STUN binding refresh</option>
                  <option value="udp">Manual UDP ping</option>
                  <option value="alg">Application-layer gateway assist</option>
                </select>
              </article>
              <article class="session-card" data-session="ftp">
                <h3>Graphics Vendor FTP</h3>
                <p class="summary">
                  Passive-mode file drop. Control on TCP 21, ephemeral data ports follow client suggestion.
                </p>
                <label for="mapping-ftp">Mapping style</label>
                <select id="mapping-ftp" name="mapping-ftp">
                  <option value="">Choose a mapping…</option>
                  <option value="static">Static pinhole</option>
                  <option value="restricted">Restricted cone</option>
                  <option value="preserving">Port-preserving</option>
                  <option value="symmetric">Symmetric</option>
                </select>
                <label for="keepalive-ftp">Keepalive tactic</label>
                <select id="keepalive-ftp" name="keepalive-ftp">
                  <option value="">Choose a keepalive…</option>
                  <option value="stun">STUN binding refresh</option>
                  <option value="udp">Manual UDP ping</option>
                  <option value="alg">Application-layer gateway assist</option>
                </select>
              </article>
              <article class="session-card" data-session="tunnel">
                <h3>Investigations VPN Tunnel</h3>
                <p class="summary">ESP-over-UDP fallback, expects periodic DPD keepalives and consistent outer ports.</p>
                <label for="mapping-tunnel">Mapping style</label>
                <select id="mapping-tunnel" name="mapping-tunnel">
                  <option value="">Choose a mapping…</option>
                  <option value="static">Static pinhole</option>
                  <option value="restricted">Restricted cone</option>
                  <option value="preserving">Port-preserving</option>
                  <option value="symmetric">Symmetric</option>
                </select>
                <label for="keepalive-tunnel">Keepalive tactic</label>
                <select id="keepalive-tunnel" name="keepalive-tunnel">
                  <option value="">Choose a keepalive…</option>
                  <option value="stun">STUN binding refresh</option>
                  <option value="udp">Manual UDP ping</option>
                  <option value="alg">Application-layer gateway assist</option>
                </select>
              </article>
            </div>
            <button type="submit" class="execute-button">Negotiate mappings</button>
          </fieldset>
        </form>
        <div id="nat-status" class="status-board" aria-live="polite">Gateway idle. Awaiting policy.</div>
      </section>
      <section class="log-panel" aria-labelledby="negotiation-log">
        <h2 id="negotiation-log">Negotiation log</h2>
        <ul id="timeline" class="log-list" aria-live="polite"></ul>
      </section>
    </main>
    <footer>Keep the translators lean and the crew online.</footer>
    <script type="module" src="./nat-handshake-lab.js"></script>
  </body>
</html>
